<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jagdamb99 - Sales & Profit Management</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1>Jagdamb99 - Sales & Profit Management</h1>

<label>Select Date:</label>
<input type="date" id="datePicker">
<br><br>

<table border="1">
    <thead>
        <tr>
            <th>Item</th>
            <th>Selling Price (₹)</th>
            <th>Profit (₹)</th>
            <th>Quantity Sold</th>
        </tr>
    </thead>
    <tbody id="menuTable"></tbody>
</table>

<h3>Total Sales: ₹<span id="totalSales">0.00</span></h3>
<h3>Total Profit: ₹<span id="totalProfit">0.00</span></h3>

<button id="saveReport">Save Report</button>

<script>
$(document).ready(function() {
    let menuData = [];

    function loadMenu() {
        $.get('/get_menu', function(data) {
            menuData = data;
            let tableContent = "";
            data.forEach(item => {
                tableContent += `
                    <tr>
                        <td>${item.Item}</td>
                        <td>${item.SellingPrice}</td>
                        <td>${item.Profit}</td>
                        <td><input type="number" min="0" value="0" class="quantity" data-item="${item.Item}" data-price="${item.SellingPrice}" data-profit="${item.Profit}"></td>
                    </tr>
                `;
            });
            $("#menuTable").html(tableContent);
        });
    }

    $(document).on('input', '.quantity', function() {
        let totalSales = 0;
        let totalProfit = 0;

        $(".quantity").each(function() {
            let quantity = parseInt($(this).val()) || 0;
            let price = parseFloat($(this).data('price'));
            let profit = parseFloat($(this).data('profit'));

            totalSales += quantity * price;
            totalProfit += quantity * profit;
        });

        $("#totalSales").text(totalSales.toFixed(2));
        $("#totalProfit").text(totalProfit.toFixed(2));
    });

    $("#saveReport").click(function() {
        let date = $("#datePicker").val();
        if (!date) {
            alert("Please select a date.");
            return;
        }

        let salesData = [];
        $(".quantity").each(function() {
            let quantity = parseInt($(this).val()) || 0;
            if (quantity > 0) {
                salesData.push({
                    name: $(this).data('item'),
                    quantity: quantity,
                    selling_price: $(this).data('price'),
                    profit: $(this).data('profit')
                });
            }
        });

        $.post("/save_sales", JSON.stringify({date: date, items: salesData}), function(response) {
            alert(response.message);
            $("#totalSales").text("0.00");
            $("#totalProfit").text("0.00");
            $(".quantity").val("0");
        }, "json");
    });

    loadMenu();
});
</script>

</body>
</html>
