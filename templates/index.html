<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jagdamb99 - Sales Entry</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        function updateTotals() {
            let totalSales = 0;
            let totalProfit = 0;
            
            document.querySelectorAll(".item-row").forEach(row => {
                let price = parseFloat(row.querySelector(".selling-price").getAttribute("data-original"));
                let profit = parseFloat(row.querySelector(".profit").getAttribute("data-original"));
                let quantity = parseInt(row.querySelector(".quantity").value) || 0;

                let updatedPrice = price * quantity;
                let updatedProfit = profit * quantity;

                row.querySelector(".selling-price").innerText = updatedPrice.toFixed(2);
                row.querySelector(".profit").innerText = updatedProfit.toFixed(2);

                totalSales += updatedPrice;
                totalProfit += updatedProfit;
            });

            document.getElementById("totalSales").innerText = totalSales.toFixed(2);
            document.getElementById("totalProfit").innerText = totalProfit.toFixed(2);
        }
    </script>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">Jagdamb99 - Sales Entry</a>
            <a class="navbar-brand" href="/analysis">Analysis</a>
        </div>
    </nav>

    <div class="container mt-5">
        <h2 class="text-center">Jagdamb99 - Sales & Profit Management</h2>

        {% if message %}
        <div class="alert alert-success">{{ message }}</div>
        {% endif %}

        <form method="post">
            <label for="date" class="form-label">Select Date:</label>
            <input type="date" id="date" name="date" class="form-control" required>

            <table class="table table-bordered mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>Item</th>
                        <th>Selling Price (₹)</th>
                        <th>Profit (₹)</th>
                        <th>Quantity Sold</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in data.iterrows() %}
                    <tr class="item-row">
                        <td>{{ row['Item'] }}</td>
                        <td class="selling-price" data-original="{{ row['Selling Price'] }}">{{ row['Selling Price'] }}</td>
                        <td class="profit" data-original="{{ row['Profit'] }}">{{ row['Profit'] }}</td>
                        <td><input type="number" class="quantity form-control" name="quantity_{{ index }}" min="0" value="0" oninput="updateTotals()"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <h5>Total Sales: ₹<span id="totalSales">0.00</span></h5>
            <h5>Total Profit: ₹<span id="totalProfit">0.00</span></h5>

            <button type="submit" class="btn btn-success mt-3">Save Report</button>
        </form>
    </div>
</body>
</html>
