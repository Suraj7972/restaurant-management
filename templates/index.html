<!DOCTYPE html>
<html>
<head>
    <title>Jagdamb99 - Sales & Profit Management</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Jagdamb99 - Sales & Profit Management</h1>
    <label>Select Date: <input type="date" id="date-picker"></label>
    <table border="1">
        <thead>
            <tr>
                <th>Item</th>
                <th>Selling Price (₹)</th>
                <th>Profit (₹)</th>
                <th>Quantity Sold</th>
            </tr>
        </thead>
        <tbody id="menu-table"></tbody>
    </table>
    <button onclick="saveReport()">Save Report</button>
    <script>
        $(document).ready(function () {
            $('#date-picker').change(function () {
                loadMenu();
            });
        });

        function loadMenu() {
            $.getJSON('/get_menu', function (data) {
                let rows = '';
                data.forEach(item => {
                    rows += `<tr>
                        <td>${item.Item}</td>
                        <td>${item["Selling Price"].toFixed(2)}</td>
                        <td>${item["Profit"].toFixed(2)}</td>
                        <td><input type="number" min="0" value="0" onchange="updateProfit(this, ${item["Selling Price"]}, ${item["Profit"]})"></td>
                    </tr>`;
                });
                $('#menu-table').html(rows);
            });
        }

        function updateProfit(input, price, profit) {
            let quantity = parseInt(input.value) || 0;
            let row = $(input).closest('tr');
            row.find('td:eq(1)').text((price * quantity).toFixed(2));
            row.find('td:eq(2)').text((profit * quantity).toFixed(2));
        }

        function saveReport() {
            let date = $('#date-picker').val();
            if (!date) {
                alert('Please select a date');
                return;
            }
            let items = [];
            $('#menu-table tr').each(function () {
                let item = {
                    "Item": $(this).find('td:eq(0)').text(),
                    "Selling Price": parseFloat($(this).find('td:eq(1)').text()),
                    "Profit": parseFloat($(this).find('td:eq(2)').text()),
                    "Quantity Sold": parseInt($(this).find('td:eq(3) input').val())
                };
                items.push(item);
            });
            $.ajax({
                url: '/save_report',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ date: date, items: items }),
                success: function (response) {
                    alert(response.message);
                }
            });
        }
    </script>
</body>
</html>
